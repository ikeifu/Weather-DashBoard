<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <section class="hero is-dark is-small">
      <div class="hero-body">
        <h1 class="title navTitle">Weather Dashboard</h1>
      </div>
    </section>
    <div class="tile is-ancestor">
      <div class="tile is-parent is-4">
        <article class="tile is-child box">
          <h1 class="title">Search for a city:</h1>
          <div class="content">
            <div class="field">
              <div class="control">
                <div class="columns">
                  <input
                    class="input cityValue column-10"
                    type="text"
                    placeholder="City"
                  />
                  <a class="button is-primary column-2 searchBtn">Search</a>
                </div>
                <div class="cityIndex"></div>
              </div>
            </div>
          </div>
        </article>
      </div>
      <div class="tile is-parent is-vertical is-8">
        <div class="tile is-child box">
          <p class="title city">City</p>
          <br />
          <p class="temperature">Temperature:</p>
          <br />
          <p class="humidity">Humidity:</p>
          <br />
          <p class="windSpeed">Wind Speed:</p>
          <br />
          <p class="uvIndex">UV Index:</p>
        </div>
        <div class="tile is-child box">
          <h1 class="title">5-Day Forecast:</h1>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      var APIKey = "e8f89c7f6e46ebcce4956f65813111a9 ";
      $(".searchBtn").on("click", function () {
        // New cities added
        var cityValue = $(this).siblings()[0].value;
        // console.log(cityValue);
        var cityDiv = $("<div>");
        var newCity = $(
          '<button class="button is-light is-large is-fullwidth">'
        );
        $(newCity).text(cityValue);
        // console.log(newCity);
        $(".cityIndex").append(cityDiv);
        $(cityDiv).prepend(newCity);
        var queryURL =
          "https://api.openweathermap.org/data/2.5/weather?q=" +
          cityValue +
          "&units=imperial&appid=" +
          APIKey;

        var forecastUrl =
          "https://api.openweathermap.org/data/2.5/forecast?q=" +
          cityValue +
          "&appid=" +
          APIKey;
        // 5 day Forecast
        $.ajax({
          url: forecastUrl,
          method: "GET",
        }).then(function (response) {
          // console.log(response);
        });
        $.ajax({
          url: queryURL,
          method: "GET",
        }).then(function (response) {
          console.log(response);
          $(".city").text(
            "City: " + response.name + " " + "(" + moment().format("LL") + ")"
          );
          $(".temperature").text("Temperature: " + response.main.temp);
          $(".humidity").text("Humidity: " + response.main.humidity);
          $(".windSpeed").text("Wind Speed: " + response.wind.speed);
          var lon = response.coord.lon;
          var lat = response.coord.lat;
          var uvUrl =
            "http://api.openweathermap.org/data/2.5/uvi?lat=" +
            lat +
            "&lon=" +
            lon +
            "&appid=" +
            APIKey;
          $.ajax({
            url: uvUrl,
            method: "GET",
          }).then(function (response) {
            // console.log(response);
            var uvi = $('<span class="tag">');
            var uvNum = response.value;
            $(uvi).text(" " + uvNum);
            if (uvNum <= 2) {
              uvi.addClass("is-success");
            } else if (uvNum <= 5) {
              uvi.addClass("is-warning");
            } else {
              uvi.addClass("is-danger");
            }
            $(".uvIndex").append(uvi);
          });
        });
      });
    </script>
  </body>
</html>
